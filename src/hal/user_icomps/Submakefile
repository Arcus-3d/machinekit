##  A rather hacky but effective way to build components from C code using instcomp
##  The dependencies to watch.so include instcomp and the userpci headers 
##  These are jobs, so this build happens after they are completed.
##  The creation of RTLIBDIRs are not jobs, so we have to make them first or this fails
##
##  Most of this can go once we just have one modules dir, they are binary identical between flavours.

HALUSERICOMPDIR= hal/user_icomps

HALUSERICOMP_SUBMAKEFILE= $(HALUSERICOMPDIR)/Submakefile

$(RTLIBDIR): Makefile.inc
	mkdir -p $(RTLIBDIR)

$(RTLIBDIR)/watch.so: $(HALUSERICOMPDIR)/watch.c ../bin/instcomp ../include/userpci/module.h $(RTLIBDIR)
	$(Q)../bin/instcomp --require-license --install $(HALUSERICOMPDIR)/watch.c

TARGETS += $(RTLIBDIR)/watch.so

